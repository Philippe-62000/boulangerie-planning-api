# üìä Documentation - Dashboard Salari√©

## üìã Vue d'ensemble

Le **Dashboard Salari√©** est une page web autonome accessible √† `https://www.filmara.fr/plan/employee-dashboard.html` qui permet aux employ√©s de g√©rer leurs demandes administratives et de consulter leurs documents personnels. Cette interface int√®gre un syst√®me complet d'envoi d'emails automatiques pour les notifications.

## üèóÔ∏è Architecture

### Frontend
- **Page** : `frontend/public/employee-dashboard.html`
- **Authentification** : Token JWT stock√© en localStorage
- **API** : Communication avec le backend via `https://boulangerie-planning-api-4-pbfy.onrender.com/api`
- **Style** : CSS int√©gr√© avec design responsive

### Backend
- **API** : Endpoints REST pour chaque fonctionnalit√©
- **Authentification** : Middleware JWT pour les salari√©s
- **Email** : Service EmailJS pour les notifications automatiques
- **Base de donn√©es** : MongoDB pour le stockage des donn√©es

## üéØ Fonctionnalit√©s

### 1. üèñÔ∏è Demande de Cong√©s
**Endpoint** : `POST /api/vacation-requests`

#### Interface utilisateur
- Formulaire avec validation c√¥t√© client
- Champs : Employ√©, Date de d√©but, Date de fin, Type de cong√©s, Pr√©cisions
- Boutons : "Demander les cong√©s" et "R√©initialiser"
- √âtat de chargement pendant le traitement

#### Syst√®me d'emails
```javascript
// Email automatique lors de la soumission
const emailResult = await emailService.sendVacationRequestNotification(
  managerEmail,
  managerName,
  employeeName,
  startDate,
  endDate,
  vacationType,
  details
);
```

**Templates d'emails** :
- **Manager** : Notification de nouvelle demande de cong√©s
- **Salari√©** : Confirmation de r√©ception de la demande

### 2. üè• D√©claration d'Arr√™t Maladie
**Endpoint** : `POST /api/sick-leave-requests`

#### Interface utilisateur
- Formulaire avec upload de document
- Validation des fichiers (JPG, PDF, max 10MB)
- Drag & Drop pour l'upload
- Pr√©visualisation du fichier s√©lectionn√©

#### Syst√®me d'emails
```javascript
// Email automatique avec pi√®ce jointe
const emailResult = await emailService.sendSickLeaveNotification(
  managerEmail,
  managerName,
  employeeName,
  employeeEmail,
  startDate,
  endDate,
  documentPath
);
```

**Templates d'emails** :
- **Manager** : Notification avec document d'arr√™t maladie
- **Salari√©** : Confirmation de r√©ception
- **Comptable** : Notification pour traitement administratif

### 3. üìÅ Gestion des Documents
**Endpoints** : 
- `GET /api/documents/general` - Documents g√©n√©raux
- `GET /api/documents/personal/:employeeId` - Documents personnels
- `GET /api/documents/download/:id` - T√©l√©chargement

#### Interface utilisateur
- **Onglets** : Documents G√©n√©raux / Documents Personnels
- **Affichage** : Liste des documents avec m√©tadonn√©es
- **Actions** : T√©l√©chargement direct
- **Gestion** : Suppression automatique apr√®s 1 mois (documents personnels)

#### Syst√®me d'emails
```javascript
// Notification lors de l'upload de documents
if (type === 'personal') {
  await emailService.sendDocumentNotification(
    employee.email,
    employee.name,
    title,
    category
  );
}

if (type === 'general') {
  // Envoi √† tous les salari√©s actifs
  for (const employee of employees) {
    await emailService.sendGeneralDocumentNotification(
      employee.email,
      employee.name,
      title,
      category
    );
  }
}
```

**Templates d'emails** :
- **Document personnel** : Notification de nouveau document disponible
- **Document g√©n√©ral** : Notification de document partag√© avec tous les salari√©s

### 4. üîê Changement de Mot de Passe
**Endpoint** : `POST /api/auth/change-password`

#### Interface utilisateur
- Formulaire s√©curis√© avec validation
- Champs : Mot de passe actuel, Nouveau mot de passe, Confirmation
- Validation c√¥t√© client (longueur minimale, correspondance)
- D√©connexion automatique apr√®s changement r√©ussi

#### S√©curit√©
- V√©rification du mot de passe actuel
- Chiffrement du nouveau mot de passe avec bcrypt
- Token JWT requis pour l'authentification

## üìß Syst√®me d'Envoi d'Emails

### Service EmailJS (`backend/services/emailService.js`)

#### Configuration
```javascript
const emailServiceAlternative = require('./emailServiceAlternative');

class EmailService {
  constructor() {
    this.isConfigured = true;
    console.log('‚úÖ Service EmailJS configur√©');
  }
}
```

#### Templates disponibles

**1. Demande de Cong√©s**
```javascript
async sendVacationRequestNotification(managerEmail, managerName, employeeName, startDate, endDate, vacationType, details) {
  const templateParams = {
    to_email: managerEmail,
    to_name: managerName,
    employee_name: employeeName,
    start_date: startDate,
    end_date: endDate,
    vacation_type: vacationType,
    details: details || 'Aucune pr√©cision'
  };
  
  return await emailServiceAlternative.sendEmail('template_vacation_request', templateParams);
}
```

**2. Arr√™t Maladie**
```javascript
async sendSickLeaveNotification(managerEmail, managerName, employeeName, employeeEmail, startDate, endDate, documentPath) {
  const templateParams = {
    to_email: managerEmail,
    to_name: managerName,
    employee_name: employeeName,
    employee_email: employeeEmail,
    start_date: startDate,
    end_date: endDate,
    document_path: documentPath
  };
  
  return await emailServiceAlternative.sendEmail('template_sick_leave', templateParams);
}
```

**3. Documents Personnels**
```javascript
async sendDocumentNotification(employeeEmail, employeeName, documentTitle, category) {
  const templateParams = {
    to_email: employeeEmail,
    to_name: employeeName,
    document_title: documentTitle,
    category: category,
    dashboard_url: 'https://www.filmara.fr/plan/employee-dashboard.html'
  };
  
  return await emailServiceAlternative.sendEmail('template_document_personal', templateParams);
}
```

**4. Documents G√©n√©raux**
```javascript
async sendGeneralDocumentNotification(employeeEmail, employeeName, documentTitle, category) {
  const templateParams = {
    to_email: employeeEmail,
    to_name: employeeName,
    document_title: documentTitle,
    category: category,
    dashboard_url: 'https://www.filmara.fr/plan/employee-dashboard.html'
  };
  
  return await emailServiceAlternative.sendEmail('template_document_general', templateParams);
}
```

### Service EmailJS Alternatif (`backend/services/emailServiceAlternative.js`)

#### Configuration EmailJS
```javascript
const emailjs = require('@emailjs/browser');

const EMAILJS_SERVICE_ID = process.env.EMAILJS_SERVICE_ID;
const EMAILJS_TEMPLATE_ID = process.env.EMAILJS_TEMPLATE_ID;
const EMAILJS_PUBLIC_KEY = process.env.EMAILJS_PUBLIC_KEY;

async function sendEmail(templateName, templateParams) {
  try {
    const templateId = getTemplateId(templateName);
    
    const result = await emailjs.send(
      EMAILJS_SERVICE_ID,
      templateId,
      templateParams,
      EMAILJS_PUBLIC_KEY
    );
    
    return {
      success: true,
      message: 'Email envoy√© avec succ√®s',
      result: result
    };
  } catch (error) {
    console.error('‚ùå Erreur envoi email:', error);
    return {
      success: false,
      message: error.message || 'Erreur inconnue'
    };
  }
}
```

## üîê Authentification

### Token JWT
- **Stockage** : localStorage du navigateur
- **Dur√©e** : 24 heures
- **Contenu** : `{employeeId, email, name, role}`
- **Validation** : Middleware `authenticateEmployee`

### Flux d'authentification
1. **Connexion** : `POST /api/auth/login`
2. **Stockage** : Token sauvegard√© en localStorage
3. **V√©rification** : √Ä chaque requ√™te API
4. **Expiration** : Redirection vers la page de connexion

## üé® Interface Utilisateur

### Design
- **Th√®me** : D√©grad√© bleu-violet moderne
- **Responsive** : Adaptation mobile et desktop
- **Animations** : Transitions fluides et √©tats de chargement
- **Couleurs** : Palette coh√©rente avec l'identit√© visuelle

### Composants
- **Header** : Logo, nom du salari√©, bouton d√©connexion
- **Navigation** : Onglets pour chaque fonctionnalit√©
- **Formulaires** : Validation en temps r√©el
- **Alertes** : Messages de succ√®s/erreur
- **Loading** : Spinners pendant les traitements

### Accessibilit√©
- **Labels** : Tous les champs ont des labels appropri√©s
- **Validation** : Messages d'erreur clairs
- **Navigation** : Tabulation logique
- **Contraste** : Couleurs respectant les standards WCAG

## üìä Gestion des √âtats

### √âtats de chargement
```javascript
// Exemple pour les demandes de cong√©s
const [loading, setLoading] = useState(false);

const handleSubmit = async (e) => {
  setLoading(true);
  try {
    // Traitement...
  } finally {
    setLoading(false);
  }
};
```

### Gestion des erreurs
```javascript
const showAlert = (containerId, message, type) => {
  const alertContainer = document.getElementById(containerId);
  alertContainer.innerHTML = `
    <div class="alert alert-${type}">
      ${message}
    </div>
  `;
};
```

## üöÄ D√©ploiement

### Frontend
- **Fichier** : `frontend/public/employee-dashboard.html`
- **Serveur** : OVH (d√©ploiement manuel via FTP)
- **URL** : `https://www.filmara.fr/plan/employee-dashboard.html`

### Backend
- **Plateforme** : Render
- **D√©ploiement** : Automatique via Git
- **URL** : `https://boulangerie-planning-api-4-pbfy.onrender.com/api`

### Variables d'environnement
```bash
# Backend (Render)
JWT_SECRET=your-jwt-secret
MONGODB_URI=mongodb://...
EMAILJS_SERVICE_ID=your-service-id
EMAILJS_TEMPLATE_ID=your-template-id
EMAILJS_PUBLIC_KEY=your-public-key
```

## üìà M√©triques et Monitoring

### Logs c√¥t√© serveur
- **Authentification** : Succ√®s/√©chec des connexions
- **Emails** : Envois r√©ussis/√©chou√©s
- **Documents** : Uploads et t√©l√©chargements
- **Erreurs** : Stack traces compl√®tes

### Logs c√¥t√© client
- **API** : R√©ponses des requ√™tes
- **Validation** : Erreurs de formulaire
- **Navigation** : Changements d'onglets
- **Performance** : Temps de chargement

## üîß Maintenance

### Points de vigilance
1. **Tokens JWT** : V√©rifier la validit√© et l'expiration
2. **Emails** : Surveiller les √©checs d'envoi
3. **Documents** : Nettoyage automatique des fichiers expir√©s
4. **Performance** : Optimisation des requ√™tes API

### Mises √† jour
1. **Templates EmailJS** : Synchronisation avec les modifications
2. **API** : Versioning des endpoints
3. **Interface** : Tests de compatibilit√© navigateurs
4. **S√©curit√©** : Mise √† jour des d√©pendances

## üß™ Tests

### Tests fonctionnels
- [x] Connexion/d√©connexion
- [x] Demande de cong√©s
- [x] D√©claration d'arr√™t maladie
- [x] Gestion des documents
- [x] Changement de mot de passe

### Tests d'int√©gration
- [x] Communication API
- [x] Envoi d'emails
- [x] Upload de fichiers
- [x] Authentification JWT

### Tests de s√©curit√©
- [x] Validation des donn√©es
- [x] Protection CSRF
- [x] Chiffrement des mots de passe
- [x] Gestion des erreurs

## üìù Changelog

### Version 1.0 (Janvier 2025)
- ‚úÖ Interface compl√®te du dashboard salari√©
- ‚úÖ Syst√®me d'authentification JWT
- ‚úÖ Gestion des demandes de cong√©s
- ‚úÖ D√©claration d'arr√™ts maladie
- ‚úÖ Syst√®me de documents (g√©n√©raux/personnels)
- ‚úÖ Changement de mot de passe
- ‚úÖ Notifications email automatiques
- ‚úÖ Interface responsive et accessible

---

**Page** : [https://www.filmara.fr/plan/employee-dashboard.html](https://www.filmara.fr/plan/employee-dashboard.html)  
**Date de cr√©ation** : Janvier 2025  
**Version** : 1.0  
**Statut** : ‚úÖ Fonctionnel et d√©ploy√©
